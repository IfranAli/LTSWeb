<div class="finances-container">

  <div class="navbar-items">
    <button class="navbar-button" (click)="openDialogAddFinance()">
      <div class="button-container">
        <span class="material-symbols-outlined">add</span>
        <span>Add Expense</span>
      </div>
    </button>
  </div>

  <ng-container *ngIf="summaries$ | async as summaries; else loading">
    <div class="summary">
      <div class="container">
        <div
          class="category"
          *ngFor="let categorySummary of summaries.summaries"
        >
          <span
            [style.width]="categorySummary.percentage"
            [style.max-width]="categorySummary.percentage"
            [style.background]="categorySummary.colour"
            class="badge bar"
          ><br/></span>

          <span
            class="label"
            [class.labelInsideBar]="categorySummary.percentageRaw >= 20"
            [ngStyle]="{
              'margin-left' :((categorySummary.percentageRaw < 20) ? categorySummary.percentage: 0)
            }"
          >
            <span class="name">
              {{ categorySummary.categoryName }}
              ({{ categorySummary.percentage }})
            </span>
          </span>
          <span class="week-total amount">{{ categorySummary.total }}</span>
        </div>
      </div>
    </div>

    <div class="cards">
      <div class="custom-card all-finances">
        <div class="title space-between no-header">
          <button class='icon-button' (click)="back()">
            <span class="material-symbols-outlined">arrow_back_ios</span>
          </button>

          <span>{{ title }}</span>

          <button class='icon-button right' (click)="forward()">
            <span class="material-symbols-outlined">arrow_forward_ios</span>
          </button>
        </div>

        <div class="custom-card-content" *ngIf="financeData$ | async as financeData else loading">
          <div
            class="finance-list"
            *ngFor="let summary of financeData; index as i">
            <div class="header">
              <div>{{ summary.categoryName }}</div>
              <div class="amount">{{ summary.total }}</div>
            </div>

            <div class="row custom-row-item"
                 (click)="openDialogAddFinance(finance.id)"
                 *ngFor="let finance of summary.items">
              <div
                class="amount"
                [class.credit]="finance.isCredit"
                [class.debit]="!finance.isCredit"
              >
                {{ finance.amountFormatted}}
              </div>
              <div class="date">{{ finance.dateFormatted }}</div>

              <span class="label">{{ finance.name }}</span>

              <div class="categoryBadge">
                <div class="badge no-outline small" [style.background]="finance.categoryColour">
                  {{ finance.categoryLabel}}
                </div>
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>
  </ng-container>
</div>

<ng-template #loading>
  <div class="summary">

    <div class="container">
      <div class="category" style="background: #8a8a8a; width: 100%">
        <span class="name">Loading</span>

        <div>
          <span style="float: right">0.0</span>
          <span style="float: left">Loading</span>
        </div>
      </div>
    </div>


  </div>
</ng-template>
