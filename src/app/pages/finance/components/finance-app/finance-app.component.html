@let summaryData = summary();

<div class="container">
  @if (summaryData) {
    @if ($selectedFinance(); as selected) {
      <app-add-finance-dialog
        [openModal]="showEditDialog()"
        [selected]="selected"
        (onModalClose)="onCloseDialogEvent($event)"
      />
    }
    @if (showImportDialog()) {
      <app-import-finance-dialog [openModal]="showImportDialog()" (onModalClose)="onCloseDialogEvent($event)" />
    }

    <app-card>
      <div card-header class="flex justify-between items-center">
        <button type="button" class="button header-button material-symbols-outlined" (click)="setDateWindow(false)">
          arrow_back_ios
        </button>

        <hgroup class="text-center">
          <h1 class="text-lg">{{ title }}</h1>
          <h2 class="text-sm">Summary</h2>
        </hgroup>

        <button type="button" class="button header-button material-symbols-outlined" (click)="setDateWindow(true)">
          arrow_forward_ios
        </button>
      </div>

      <div card-body>
        @if (summaryData.summary.length > 0) {
          @for (item of summaryData.summary; track item.categoryName) {
            @let total = item.total | currency;

            <div
              class="expense-bar"
              [style]="{
                '--item-percentage': item.percentage,
                '--item-colour': item.colour,
              }"
            >
              <div class="bar">&nbsp;</div>

              <div class="label">
                <div>
                  {{ item.percentage }}
                  {{ item.categoryName }}
                </div>
                <div class="font-bold">
                  {{ total }}
                </div>
              </div>
            </div>
          }
        } @else {
          <div class="text-center text-sm text-disabled">No data available</div>
        }
      </div>

      <div card-footer class="flex gap-2">
        <button class="button" (click)="openDialogAddFinance()">Add Expense</button>
        <button class="button" (click)="openDialogImport()">Import</button>
      </div>
    </app-card>
  }

  @if (summaryData?.financeDataByWeekly && summaryData.financeDataByWeekly.length > 0) {
    @if (summaryData.financeDataByWeekly; as financesByWeekly) {
      @if (financesByWeekly.length > 0) {
        <app-summary-view
          (itemClickEvent)="openDialogAddFinance($event)"
          [finances]="financesByWeekly"
        ></app-summary-view>
      }
    }
  }
</div>
